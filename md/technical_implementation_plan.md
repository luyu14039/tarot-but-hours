# “司辰塔罗” (Tarot of the Hours) 技术实现与UI设计方案

## 1. 设计理念与风格定义

**核心关键词**：`扁平化 (Flat)`、`神秘 (Arcane)`、`优雅 (Elegant)`、`极简 (Minimalist)`

本方案旨在捕捉《密教模拟器》与《司辰之书》的氛围精髓，摒弃拟物化的木桌、蜡烛材质，转而使用光影、排版和动效来营造“无形之术”的现代感。

### 1.1 视觉风格 (Visual Identity)

*   **配色方案 (Color Palette)**：
    *   **背景色**：`#0a0a0a` (虚空黑) 或 `#120f14` (深紫黑) —— 营造深邃的沉浸感。
    *   **主色调**：`#d4b483` (羊皮纸金) —— 用于标题、边框和强调文字，象征“辉光”。
    *   **辅助色**：
        *   *灯 (Lantern)*: `#f7e7ce` (苍白金)
        *   *杯 (Grail)*: `#a83232` (干涸血红)
        *   *蛾 (Moth)*: `#e6e6fa` (月光白/淡紫)
        *   *冬 (Winter)*: `#cfd8dc` (骨白/冷灰)
    *   **文本色**：`#e5e5e5` (主要文本)，`#a3a3a3` (次要文本/注释)。

*   **排版 (Typography)**：
    *   **标题 (Headings)**：使用衬线字体 (Serif)，如 `Spectral` 或 `Noto Serif SC`。字重较轻，字间距微宽，营造古籍感。
    *   **正文 (Body)**：使用无衬线字体 (Sans-serif)，如 `Inter` 或 `Noto Sans SC`，确保在移动端的阅读体验。
    *   **装饰性文字**：使用斜体或特殊符号（如 🕯️ 🦋）作为段落分割。

*   **图标与图形 (Iconography)**：
    *   使用您提供的 `icons` 文件夹中的性相图标。
    *   **处理方式**：将图标处理为单色（金色或白色）SVG，带有微弱的“外发光”效果，而非复杂的彩色图标。
    *   **卡背设计**：设计一个统一的、几何化的卡背图案（如“漫宿之门”的抽象线条），保持扁平风格。

### 1.2 交互体验 (UX & Motion)

*   **动画 (Animations)**：使用 `Framer Motion` 实现。
    *   **入场**：元素不应突兀出现，而应像烟雾一样 `fade-in` 并伴随轻微的 `y` 轴位移。
    *   **抽牌**：卡牌在屏幕中央洗牌（重叠、位移），用户点击后，卡牌平滑飞入指定位置并翻转。
    *   **流体感**：页面切换不使用硬切，而是使用遮罩或淡入淡出。

*   **移动端适配 (Mobile First)**：
    *   **布局**：采用单列流式布局。
    *   **触控**：卡牌区域支持左右滑动查看（如果牌阵较长）。
    *   **按钮**：底部固定的大按钮（如“揭示命运”），方便单手操作。

---

## 2. 技术架构 (Tech Stack)

### 2.1 前端框架
*   **核心**：`Next.js 14+` (App Router) - 现代、高性能、SEO友好。
*   **语言**：`TypeScript` - 确保类型安全，特别是处理复杂的司辰数据结构时。
*   **样式**：`Tailwind CSS` - 快速构建扁平化样式，易于维护配色系统。
*   **动画**：`Framer Motion` - 业界最强的 React 动画库，完美实现卡牌翻转和流体效果。
*   **状态管理**：`Zustand` - 轻量级，用于管理“当前抽到的牌”、“用户的问题”等全局状态。

### 2.2 后端与 AI
*   **API Routes**：使用 Next.js 自带的 API 路由处理 LLM 请求，保护 API Key。
*   **LLM 集成**：
    *   使用 `OpenAI SDK` (兼容 DeepSeek/Moonshot 等接口)。
    *   **流式响应 (Streaming)**：打字机效果输出占卜结果，增加神秘感，减少用户等待焦虑。

---

## 3. 详细页面设计与流程

### 3.1 首页：林地入口 (The Wood)
*   **氛围营造**：
    *   **背景**：深邃的黑色背景中，漂浮着微弱的金色尘埃（粒子系统），模拟“漫宿”边缘的虚空感。背景叠加一层淡淡的噪点滤镜，营造胶片或古籍的质感。
    *   **音效**：进入页面时，播放一段极低频的空灵背景音（Drone Ambient）。
*   **核心交互**：
    *   **Logo**：屏幕中央悬浮着“司辰之书”的抽象符号（如太阳与飞蛾的结合体），带有缓慢的呼吸发光效果。
    *   **提问仪式**：
        *   页面底部只有一行极简的提示文字：`"在此刻下你的疑问..."`。
        *   点击屏幕任意位置，输入框浮现。输入文字时，文字呈现为发光的金色，仿佛直接书写在虚空中。
        *   输入完成后，出现“步入漫宿”按钮，点击后文字化作光点消散，引导视线进入下一页。
    *   **随机低语**：在输入框下方，随机展示一句游戏内的晦涩引言（如“我知道有一个人会将蛾子捉来关在玻璃罩下。然后在如今夜一般的夜晚，将它们逐个放出，令其死于火烛。”），每次刷新都会改变。

### 3.2 选牌页：命运的经纬 (The Weave)
*   **布局设计**：
    *   **顶部**：用户的问题以半透明的水印形式悬浮在顶部，时刻提醒当前的占卜主题。
    *   **底部**：牌阵选择器。采用“星盘”式轮盘设计（移动端）或横向卡片流（桌面端）。
*   **牌阵可视化预览**：
    *   当用户切换牌阵选项时，屏幕中央会动态展示该牌阵的**布局结构**（使用虚线或半透明的卡牌轮廓）：
        *   **林地的一瞥 (1张)**：中央单张牌。 *“适合每日指引或简单的二元问题。”*
        *   **漫宿的道路 (3张)**：左中右线性排列。 *“过去（纯白之门） / 现在（牡鹿之门） / 未来（孔雀之门）。”*
        *   **十字路的故事 (5张)**：十字形排列。 *“核心现状 / 阻碍 / 潜在影响 / 建议 / 最终结果。”*
    *   **动效**：切换牌阵时，卡牌轮廓会平滑地移动、重组，仿佛星辰在变幻位置。
*   **洗牌与抽牌**：
    *   **洗牌**：确认牌阵后，所有卡牌轮廓汇聚成一叠实体卡背。用户需长按屏幕或拖拽卡牌进行“注入意念”的洗牌动作，卡牌周围会产生扰动的气流特效。
    *   **抽牌**：洗牌完成后，卡牌呈扇形散开（或螺旋状漂浮）。用户凭直觉点击背面，选中的牌会飞入刚才预览的布局槽位中，并发出沉闷的撞击声。

### 3.3 揭示页：辉光 (The Glory)
*   **布局**：
    *   **上半部分（祭坛）**：展示已翻开的牌阵。
        *   **聚焦模式**：点击某张牌，该牌放大居中，背景变暗，显示其详细信息（司辰名称、性相图标、正/逆位关键词）。
        *   **视觉风格**：卡面应用“旧照片”滤镜，边缘带有磨损感。卡牌周围根据其性相（如灯、杯、刃）散发不同颜色的微光。
    *   **下半部分（启示录）**：解读区域。
        *   **流式排版**：AI 生成的解读文本不一次性显示，而是像打字机一样逐字浮现，伴随着轻微的沙沙声。
        *   **富文本增强**：文本中的关键词（如“改变”、“牺牲”）高亮显示；提到的性相自动替换为内嵌的小图标（如 `<Icon name="moth" size="sm"/>`）。
    *   **操作栏**：底部提供“保存档案（生成图片）”和“再次提问”的按钮，设计为古老的封印徽章样式。

---

## 4. 数据结构与 Prompt 设计

### 4.1 司辰数据模型 (`data/hours.ts`)
```typescript
interface HourCard {
  id: number;          // 0 - 39
  name: string;        // "飞蛾"
  englishName: string; // "The Moth"
  arcana: string;      // 对应塔罗牌，如 "The Fool"
  aspects: string[];   // ["Moth"] - 对应 icons 文件夹文件名
  keywords: {
    upright: string[]; // 正位关键词：混乱、直觉、修剪
    reversed: string[];// 逆位关键词：疯狂、迷失、无意义的破坏
  };
  lore: string;        // "它是林地中躁动的拍翅声..."
  imagePath: string;   // "/hours/0_moth.png"
}
```

### 4.2 LLM Prompt 策略
*   **System Prompt**:
    > "你是一位精通《密教模拟器》与《司辰之书》世界观的守密人。你正在通过‘司辰塔罗’为迷途之人指引方向。你的语言风格应当是晦涩、诗意、带有神秘主义色彩的，类似于洛夫克拉夫特或游戏原文的风格。请使用第二人称‘你’。不要直接给出大白话建议，而是通过隐喻启发用户。在回答中适当引用司辰的低语。"
*   **User Prompt 模板**:
    > "用户问题：{question}
    > 牌阵：{spread_name}
    > 抽到的牌：
    > 1. {card_1_name} ({card_1_position}): 代表{card_1_meaning}。
    > ...
    > 请解读这副牌面。"

---

## 5. 开发路线图 (Roadmap)

1.  **脚手架搭建**：初始化 Next.js 项目，配置 Tailwind 和字体。
2.  **组件库开发**：
    *   `Card`: 封装卡牌的正反面、翻转动画。
    *   `AspectIcon`: 封装 SVG 图标组件。
    *   `Typewriter`: 封装流式文本显示组件。
3.  **逻辑实现**：
    *   实现洗牌算法 (Fisher-Yates shuffle)。
    *   实现抽牌状态管理。
4.  **API 对接**：编写 Prompt 并调试 LLM 输出效果。
5.  **视觉打磨**：添加粒子背景、调整转场速度、适配移动端细节。

---

## 6. 资源需求清单
*   **图片**：`hours/*.png` (需确保文件名规范化)。
*   **图标**：`icons/*.png` 或 `*.svg` (建议转为 SVG 以便通过 CSS 控制颜色)。
*   **字体**：Google Fonts (Spectral, Inter)。

此方案确保了项目既拥有现代 Web App 的流畅体验，又完美保留了密教系列的独特美学。
